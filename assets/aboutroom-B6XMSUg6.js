import{u as B,aE as E,i as I,r as h,L as D,o as d,a3 as v,w as a,b as t,N,a6 as y,t as g,c as x,d as $,l as L,h as O,V as T,n as P,e as A,F,$ as H}from"./index-BDg8gbUh.js";import{V as c}from"./VCol-CFPHdyK4.js";import{V as Q}from"./VDateInput-CO7DbMbe.js";import{V as R}from"./VContainer-C4R6LVF2.js";import{V as U}from"./VRow-BrnTJMBU.js";import"./calendar-Cu9OwuBz.js";import"./VMenu-DY2S682y.js";const j={key:0},z={key:1},G={__name:"ProductCard",props:["_id","category","description","quantity","image","name","price","sell"],setup(p){const m=B(),_=E(),o=I(),{apiAuth:u}=P(),f=p,e=h(null),b=D(()=>new Date().toISOString().split("T")[0]),i=h(0),w=async r=>{if(r!==null){const s=r[0];i.value=f.quantity;const l=new Date(s);l.setHours(l.getHours()+8);const n=l.toISOString();await C(n)}else o({text:"要選範圍",snackbarProps:{color:"red"}})},C=async r=>{var s,l;try{const{data:n}=await u.get("/order/all");n.result.forEach(k=>{k.cart.forEach(V=>{V.p_id._id===f._id&&V.date.forEach(q=>{r===q&&(i.value-=k.cart[0].quantity)})})})}catch(n){console.log(n),o({text:((l=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red"}})}},S=async()=>{if(!m.isLogin){_.push("/login");return}if(e.value===null){o({text:"沒有選擇日期",snackbarProps:{color:"red"}});return}else if(e.value.length<2){o({text:"請選擇至少兩天的日期範圍",snackbarProps:{color:"red"}});return}else if(e.value[1]===b.value){o({text:"結束日期不能為今天",snackbarProps:{color:"red"}});return}try{const{data:r}=await u.get("/user/cart");if(console.log("finalQuantity.value",i.value),r.result.length===0){const s=m.addCart(f._id,1,e.value);o({text:"增加成功",snackbarProps:{color:"green"}})}else if(i.value>=r.result[0].quantity+1){const s=m.addCart(f._id,1,e.value);o({text:"增加成功",snackbarProps:{color:"green"}}),console.log("data.result[0].quantity",r.result[0].quantity)}else o({text:"房間數量不足",snackbarProps:{color:"red"}})}catch(r){console.error("添加購物車時出錯:",r),o({text:"發生錯誤，請稍後再試",snackbarProps:{color:"red"}})}};return(r,s)=>(d(),v(T,{class:"d-flex align-center text-center h-100"},{default:a(()=>[t(c,{cols:"3"},{default:a(()=>[t(N,{src:p.image,cover:"",height:"500"},null,8,["src"])]),_:1}),t(c,{col:"1"},{default:a(()=>[y("h3",null,g(p.name),1)]),_:1}),t(c,null,{default:a(()=>[e.value?(d(),x("h3",j,"剩餘數量: "+g(i.value),1)):(d(),x("h3",z,"請選擇日期"))]),_:1}),t(c,null,{default:a(()=>[y("h3",null,"價格$"+g(p.price),1)]),_:1}),t(c,{cols:"2"},{default:a(()=>[t($(Q),{modelValue:e.value,"onUpdate:modelValue":[s[0]||(s[0]=l=>e.value=l),w],label:"訂房日期",multiple:"range",min:b.value,"max-weight":"365"},null,8,["modelValue","min"])]),_:1}),t(c,{cols:"3"},{default:a(()=>[t(L,{color:"primary",type:"submit","prepend-icon":"mdi-cart",onClick:S,disabled:e.value===null||i.value<=0},{default:a(()=>[O(g(e.value===null?"請先選擇日期":i.value>0?"加入購物車":"已售完"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}},J=y("h1",{class:"text-center"},"立即訂房",-1),te={__name:"aboutroom",setup(p){const{api:m}=P(),_=h([]);return(async()=>{try{const{data:u}=await m.get("/product",{params:{itemsPerPage:100}});_.value=u.result.data}catch(u){console.error(u)}})(),(u,f)=>(d(),v(R,null,{default:a(()=>[t(U,null,{default:a(()=>[t(c,{cols:"12"},{default:a(()=>[J]),_:1}),(d(!0),x(F,null,A(_.value,e=>(d(),v(c,{cols:"12",key:e._id},{default:a(()=>[t(G,H({ref_for:!0},e),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{te as default};
