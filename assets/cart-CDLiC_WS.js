import{i as $,u as E,r as g,L as C,a3 as N,w as n,aE as O,o as h,b as r,c as q,t as d,l as u,h as m,a6 as f,n as P}from"./index-Dldl11PT.js";import{V as A}from"./VContainer-CrIzMt7H.js";import{V as y}from"./VCol-s55D68Y_.js";import{V as L}from"./VDivider-BnwFuaNK.js";import{V as R}from"./VDataTable-DP3zAh6S.js";import"./VList-CyokpfsB.js";import"./ssrBoot-CajkDQlw.js";import"./VMenu-CWB_LgLG.js";import"./VChip-DDbJudka.js";const U=f("h1",{class:"text-center"},"購物車",-1),j={key:0},z={key:1,class:"text-red"},tt={__name:"cart",props:["_id","category","description","quantity","image","name","price","sell","room"],setup(F){const{apiAuth:k}=P(),V=O(),p=$(),v=E(),l=g([]),w=[{title:"品名",key:"p_id.name"},{title:"房間價格",key:"p_id.price"},{title:"房間數量",key:"quantity"},{title:"日期",key:"date",value:e=>{const a=e.date;if(a&&a.length>0){const t=new Date(a[0]).toISOString().split("T")[0];let o="";if(a.length===1)o=new Date(new Date(t).setDate(new Date(t).getDate()+1)).toISOString().split("T")[0];else if(a.length>1){console.log("dates.length",a.length);const s=new Date(a[a.length-1]);s.setDate(s.getDate()+1),o=s.toISOString().split("T")[0]}return`${t}日入住 至 ${o} 日退房`}return"無日期"}},{title:"天數",key:"days",value:e=>e.date?e.date.length:0},{title:"總價",key:"total",value:e=>e.p_id.price*e.quantity*(e.date?e.date.length:0)},{title:"操作",key:"action"}];(async()=>{var e,a;try{const{data:t}=await k.get("/user/cart");l.value=t.result;const o=l.value.map(s=>s.quantity)}catch(t){console.log(t),p({text:((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const S=C(()=>l.value.reduce((e,a)=>e+a.quantity*a.p_id.price*a.date.length,0)),b=C(()=>l.value.length>0&&!l.value.some(e=>!e.p_id.sell)),D=g(!1),B=async()=>{D.value=!0;const e=await v.checkout();p({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"&&V.push("/orders"),D.value=!1};g(0);const _=async(e,a,t)=>{const o=await v.addCart(e,a,t);if(console.log("result",o),p({text:o.text,snackbarProps:{color:o.color}}),o.color==="green"){const i=l.value.findIndex(c=>c.p_id._id===e);console.log("Date parameter:",t),l.value[i].quantity+=a,l.value[i].quantity<=0&&l.value.splice(i,1)}const{data:s}=await k.get("/order/all");s.result.forEach(i=>{let c=s.result[s.result.length-1].cart[0].p_id.quantity;i.cart.forEach(x=>{const I=s.result[s.result.length-1].cart[0].p_id._id;if(x.p_id._id===I){const T=x.quantity;c-=T,console.log(c)}})})};return(e,a)=>(h(),N(A,null,{default:n(()=>[r(y,{cols:"12"},{default:n(()=>[U]),_:1}),r(L),r(y,{cols:"12"},{default:n(()=>[r(R,{items:l.value,headers:w},{"item.p_id.name":n(({item:t})=>[t.p_id.sell?(h(),q("span",j,d(t.p_id.name),1)):(h(),q("span",z,d(t.p_id.name)+" (已下架)",1))]),"item.quantity":n(({item:t})=>[r(u,{variant:"text",color:"red",onClick:o=>_(t.p_id._id,-1,t.date)},{default:n(()=>[m("-")]),_:2},1032,["onClick"]),f("span",null,d(t.quantity),1),r(u,{variant:"text",color:"green",onClick:o=>_(t.p_id._id,1,t.date)},{default:n(()=>[m("+")]),_:2},1032,["onClick"])]),"item.action":n(({item:t})=>[r(u,{variant:"text",color:"red",icon:"mdi-delete",onClick:o=>_(t.p_id._id,t.quantity*-1,t.date*1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),r(y,{cols:"12",class:"text-center"},{default:n(()=>[f("p",null,"總金額: "+d(S.value),1),r(u,{color:"green",disabled:!b.value,onClick:B},{default:n(()=>[m("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{tt as default};
