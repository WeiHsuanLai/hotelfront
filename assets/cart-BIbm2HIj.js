import{i as q,u as I,r as m,L as v,a3 as B,w as o,aE as T,o as p,b as l,c as y,t as c,l as i,h as _,a6 as f,n as $}from"./index-DjxrM9kz.js";import{V as N}from"./VContainer-BlsM2P_3.js";import{V as k}from"./VCol-CxPt3hGo.js";import{V as O}from"./VDivider-BcnLaL48.js";import{V as P}from"./VDataTable-BUVg1588.js";import"./VList-Buei6j9H.js";import"./ssrBoot-C0hcEdkP.js";import"./VMenu-CszNxHnm.js";import"./VChip-C42dMxPu.js";const A=f("h1",{class:"text-center"},"購物車",-1),E={key:0},L={key:1,class:"text-red"},W={__name:"cart",setup(R){const{apiAuth:D}=$(),x=T(),d=q(),g=I(),n=m([]),C=[{title:"品名",key:"p_id.name"},{title:"房間價格",key:"p_id.price"},{title:"房間數量",key:"quantity"},{title:"日期",key:"date",value:t=>{const a=t.date;if(a&&a.length>0){const e=new Date(a[0]).toISOString().split("T")[0];let s="";if(a.length===1)s=new Date(new Date(e).setDate(new Date(e).getDate()+1)).toISOString().split("T")[0];else if(a.length>1){const r=new Date(a[a.length-1]);r.setDate(r.getDate()),s=r.toISOString().split("T")[0]}return`${e}日入住 至 ${s} 日退房`}return"無日期"}},{title:"天數",key:"days",value:t=>t.date?t.date.length:0},{title:"總價",key:"total",value:t=>t.p_id.price*t.quantity*(t.date?t.date.length:0)},{title:"操作",key:"action"}];(async()=>{var t,a;try{const{data:e}=await D.get("/user/cart");n.value=e.result}catch(e){console.log(e),d({text:((a=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const V=v(()=>n.value.reduce((t,a)=>t+a.quantity*a.p_id.price*a.date.length,0)),w=v(()=>n.value.length>0&&!n.value.some(t=>!t.p_id.sell)),h=m(!1),S=async()=>{h.value=!0;const t=await g.checkout();d({text:t.text,snackbarProps:{color:t.color}}),t.color==="green"&&x.push("/orders"),h.value=!1},u=async(t,a,e)=>{const s=await g.addCart(t,a,e);if(d({text:s.text,snackbarProps:{color:s.color}}),s.color==="green"){const r=n.value.findIndex(b=>b.p_id._id===t);console.log("Date parameter:",e),n.value[r].quantity+=a,n.value[r].quantity<=0&&n.value.splice(r,1)}};return(t,a)=>(p(),B(N,null,{default:o(()=>[l(k,{cols:"12"},{default:o(()=>[A]),_:1}),l(O),l(k,{cols:"12"},{default:o(()=>[l(P,{items:n.value,headers:C},{"item.p_id.name":o(({item:e})=>[e.p_id.sell?(p(),y("span",E,c(e.p_id.name),1)):(p(),y("span",L,c(e.p_id.name)+" (已下架)",1))]),"item.quantity":o(({item:e})=>[l(i,{variant:"text",color:"red",onClick:s=>u(e.p_id._id,-1,e.date)},{default:o(()=>[_("-")]),_:2},1032,["onClick"]),f("span",null,c(e.quantity),1),l(i,{variant:"text",color:"green",onClick:s=>u(e.p_id._id,1,e.date)},{default:o(()=>[_("+")]),_:2},1032,["onClick"])]),"item.action":o(({item:e})=>[l(i,{variant:"text",color:"red",icon:"mdi-delete",onClick:s=>u(e.p_id._id,e.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),l(k,{cols:"12",class:"text-center"},{default:o(()=>[f("p",null,"總金額: "+c(V.value),1),l(i,{color:"green",disabled:!w.value,onClick:S},{default:o(()=>[_("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{W as default};
