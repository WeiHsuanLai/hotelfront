import{i as S,u as B,r as y,L as h,af as I,w as s,aZ as $,o as p,b as n,c as g,t as r,l as c,h as _,ai as f,n as T}from"./index-D1rVZMnS.js";import{V as N}from"./VContainer-CvW6Gi3O.js";import{V as k}from"./VCol-CPa67INW.js";import{V as P}from"./VDivider-ChXDXOIk.js";import{a as A}from"./VDataTable-D2iISWUd.js";import"./VList-BBrZecQj.js";import"./ssrBoot-sUAhX7jW.js";const O=f("h1",{class:"text-center"},"購物車",-1),E={key:0},L={key:1,class:"text-red"},K={__name:"cart",setup(R){const{apiAuth:x}=T(),C=$(),i=S(),m=B(),o=y([]),V=[{title:"品名",key:"p_id.name"},{title:"房間價格",key:"p_id.price"},{title:"房間數量",key:"quantity"},{title:"日期",key:"date",value:e=>{const a=e.date;if(a&&a.length>0){const t=new Date(a[0]).toISOString().split("T")[0],l=new Date(a[a.length-1]).toISOString().split("T")[0];return`${t} 至 ${l}`}return"無日期"}},{title:"天數",key:"days",value:e=>e.date.length-1},{title:"總價",key:"total",value:e=>e.p_id.price*e.quantity*(e.date.length-1)},{title:"操作",key:"action"}];(async()=>{var e,a;try{const{data:t}=await x.get("/user/cart");o.value=t.result}catch(t){console.log(t),i({text:((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const b=h(()=>o.value.reduce((e,a)=>e+a.quantity*a.p_id.price*(a.date.length-1),0)),q=h(()=>o.value.length>0&&!o.value.some(e=>!e.p_id.sell)),v=y(!1),w=async()=>{v.value=!0;const e=await m.checkout();i({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"&&C.push("/orders"),v.value=!1},d=async(e,a,t)=>{const l=await m.addCart(e,a,t);if(i({text:l.text,snackbarProps:{color:l.color}}),l.color==="green"){const u=o.value.findIndex(D=>D.p_id._id===e);o.value[u].quantity+=a,o.value[u].quantity<=0&&o.value.splice(u,1)}};return(e,a)=>(p(),I(N,null,{default:s(()=>[n(k,{cols:"12"},{default:s(()=>[O]),_:1}),n(P),n(k,{cols:"12"},{default:s(()=>[n(A,{items:o.value,headers:V},{"item.p_id.name":s(({item:t})=>[t.p_id.sell?(p(),g("span",E,r(t.p_id.name),1)):(p(),g("span",L,r(t.p_id.name)+" (已下架)",1))]),"item.quantity":s(({item:t})=>[n(c,{variant:"text",color:"red",onClick:l=>d(t.p_id._id,-1)},{default:s(()=>[_("-")]),_:2},1032,["onClick"]),f("span",null,r(t.quantity),1),n(c,{variant:"text",color:"green",onClick:l=>d(t.p_id._id,1,t.date)},{default:s(()=>[_("+")]),_:2},1032,["onClick"])]),"item.action":s(({item:t})=>[n(c,{variant:"text",color:"red",icon:"mdi-delete",onClick:l=>d(t.p_id._id,t.quantity*-1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),n(k,{cols:"12",class:"text-center"},{default:s(()=>[f("p",null,"總金額: "+r(b.value),1),n(c,{color:"green",disabled:!q.value,onClick:w},{default:s(()=>[_("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{K as default};
