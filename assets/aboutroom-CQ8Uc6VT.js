import{u as E,aE as I,i as D,r as v,L as N,a as $,o as p,a3 as h,w as a,b as t,N as L,h as V,t as g,c as y,a6 as P,d as O,l as T,V as A,n as C,e as F,F as H,$ as Q}from"./index-Da3gTHpW.js";import{V as c}from"./VCol-D4nKaeOI.js";import{V as R}from"./VDateInput-Dyoa-3l-.js";import{V as U}from"./VContainer-CWCGpbLV.js";import{V as j}from"./VRow-DPgt9EVX.js";import"./calendar-J-_b1nwv.js";import"./VMenu-lBjY_bdj.js";const z={key:0},G={key:1},J={__name:"ProductCard",props:["_id","category","description","quantity","image","name","price","sell"],setup(d){const m=E(),_=I(),o=D(),{apiAuth:u}=C(),f=d,e=v(null),k=N(()=>new Date().toISOString().split("T")[0]),i=v(0),w=async r=>{if(r!==null){const l=r[0];i.value=f.quantity;const n=new Date(l);n.setHours(n.getHours()+8);const s=n.toISOString();await S(s)}else o({text:"要選範圍",snackbarProps:{color:"red"}})},S=async r=>{var l,n;try{const{data:s}=await u.get("/order/all");s.result.forEach(x=>{x.cart.forEach(b=>{b.p_id._id===f._id&&b.date.forEach(B=>{r===B&&(i.value-=x.cart[0].quantity)})})})}catch(s){console.log(s),o({text:((n=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:n.message)||"發生錯誤",snackbarProps:{color:"red"}})}},q=async()=>{if(!m.isLogin){_.push("/login");return}if(e.value===null){o({text:"沒有選擇日期",snackbarProps:{color:"red"}});return}else if(e.value.length<2){o({text:"請選擇至少兩天的日期範圍",snackbarProps:{color:"red"}});return}else if(e.value[1]===k.value){o({text:"結束日期不能為今天",snackbarProps:{color:"red"}});return}try{const{data:r}=await u.get("/user/cart");if(console.log("finalQuantity.value",i.value),r.result.length===0){const l=m.addCart(f._id,1,e.value);o({text:"增加成功",snackbarProps:{color:"green"}})}else if(i.value>=r.result[0].quantity+1){const l=m.addCart(f._id,1,e.value);o({text:"增加成功",snackbarProps:{color:"green"}}),console.log("data.result[0].quantity",r.result[0].quantity)}else o({text:"房間數量不足",snackbarProps:{color:"red"}})}catch(r){console.error("添加購物車時出錯:",r),o({text:"發生錯誤，請稍後再試",snackbarProps:{color:"red"}})}};return(r,l)=>{const n=$("router-link");return p(),h(A,{class:"d-flex align-center text-center h-100"},{default:a(()=>[t(c,{cols:"3"},{default:a(()=>[t(L,{src:d.image,cover:"",height:"500"},null,8,["src"])]),_:1}),t(c,{col:"1"},{default:a(()=>[t(n,{to:"/products/"+d._id},{default:a(()=>[V(g(d.name),1)]),_:1},8,["to"])]),_:1}),t(c,null,{default:a(()=>[e.value?(p(),y("h3",z,"剩餘數量: "+g(i.value),1)):(p(),y("h3",G,"請選擇日期"))]),_:1}),t(c,null,{default:a(()=>[P("h3",null,"價格$"+g(d.price),1)]),_:1}),t(c,{cols:"2"},{default:a(()=>[t(O(R),{modelValue:e.value,"onUpdate:modelValue":[l[0]||(l[0]=s=>e.value=s),w],label:"訂房日期",multiple:"range",min:k.value,"max-weight":"365"},null,8,["modelValue","min"])]),_:1}),t(c,{cols:"3"},{default:a(()=>[t(T,{color:"primary",type:"submit","prepend-icon":"mdi-cart",onClick:q,disabled:e.value===null||i.value<=0},{default:a(()=>[V(g(e.value===null?"請先選擇日期":i.value>0?"加入購物車":"已售完"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})}}},K=P("h1",{class:"text-center"},"立即訂房",-1),ae={__name:"aboutroom",setup(d){const{api:m}=C(),_=v([]);return(async()=>{try{const{data:u}=await m.get("/product",{params:{itemsPerPage:100}});_.value=u.result.data}catch(u){console.error(u)}})(),(u,f)=>(p(),h(U,null,{default:a(()=>[t(j,null,{default:a(()=>[t(c,{cols:"12"},{default:a(()=>[K]),_:1}),(p(!0),y(H,null,F(_.value,e=>(p(),h(c,{cols:"12",key:e._id},{default:a(()=>[t(J,Q({ref_for:!0},e),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{ae as default};
