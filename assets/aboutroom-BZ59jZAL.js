import{u as I,aE as $,i as N,r as y,L as O,o as f,a3 as x,w as t,b as e,N as T,a6 as v,t as _,m as A,l as h,$ as w,V as C,j as L,k as R,a5 as j,c as k,d as F,h as H,n as S,e as Q,F as U}from"./index-DIJN7c7K.js";import{V as u}from"./VCol-CRZCXSF_.js";import{V as M}from"./VDateInput-DAIhqX95.js";import{V as z}from"./VContainer-owqH7OsQ.js";import{V as G}from"./VRow-CDdcNvxA.js";import"./calendar-DiDToDKY.js";import"./VMenu-yAWfIe41.js";const J={key:0},K={key:1},W={__name:"ProductCard",props:["_id","category","description","quantity","image","name","price","sell"],setup(d){const p=I(),g=$(),o=N(),{apiAuth:c}=S(),m=d,a=y(null),V=O(()=>new Date().toISOString().split("T")[0]),i=y(0),q=async r=>{if(r!==null){const s=r[0];i.value=m.quantity;const l=new Date(s);l.setHours(l.getHours()+8);const n=l.toISOString();await E(n)}else o({text:"要選範圍",snackbarProps:{color:"red"}})},E=async r=>{var s,l;try{const{data:n}=await c.get("/order/all");n.result.forEach(b=>{b.cart.forEach(P=>{P.p_id._id===m._id&&P.date.forEach(D=>{r===D&&(i.value-=b.cart[0].quantity)})})})}catch(n){console.log(n),o({text:((l=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red"}})}},B=async()=>{if(!p.isLogin){g.push("/login");return}if(a.value===null){o({text:"沒有選擇日期",snackbarProps:{color:"red"}});return}else if(a.value.length<2){o({text:"請選擇至少兩天的日期範圍",snackbarProps:{color:"red"}});return}else if(a.value[1]===V.value){o({text:"結束日期不能為今天",snackbarProps:{color:"red"}});return}try{const{data:r}=await c.get("/user/cart");if(console.log("finalQuantity.value",i.value),r.result.length===0){const s=p.addCart(m._id,1,a.value);o({text:"增加成功",snackbarProps:{color:"green"}})}else if(i.value>=r.result[0].quantity+1){const s=p.addCart(m._id,1,a.value);o({text:"增加成功",snackbarProps:{color:"green"}}),console.log("data.result[0].quantity",r.result[0].quantity)}else o({text:"房間數量不足",snackbarProps:{color:"red"}})}catch(r){console.error("添加購物車時出錯:",r),o({text:"發生錯誤，請稍後再試",snackbarProps:{color:"red"}})}};return(r,s)=>(f(),x(C,{class:"d-flex align-center text-center h-100"},{default:t(()=>[e(u,{cols:"3"},{default:t(()=>[e(T,{src:d.image,cover:"",height:"500"},null,8,["src"])]),_:1}),e(u,{col:"1"},{default:t(()=>[v("h3",null,_(d.name),1)]),_:1}),e(u,null,{default:t(()=>[e(A,{"max-width":"500"},{activator:t(({props:l})=>[e(h,w(l,{color:"surface-variant",text:"MORE",variant:"flat"}),null,16)]),default:t(({isActive:l})=>[e(C,null,{default:t(()=>[e(L,null,{default:t(()=>[v("div",null,_(d.description),1)]),_:1}),e(R,null,{default:t(()=>[e(h,{text:"關閉介紹",onClick:n=>l.value=!1,color:"black",variant:"flat"},null,8,["onClick"]),e(j)]),_:2},1024)]),_:2},1024)]),_:1})]),_:1}),e(u,null,{default:t(()=>[a.value?(f(),k("h3",J,"剩餘數量: "+_(i.value),1)):(f(),k("h3",K,"請選擇日期"))]),_:1}),e(u,null,{default:t(()=>[v("h3",null,"價格$"+_(d.price),1)]),_:1}),e(u,{cols:"2"},{default:t(()=>[e(F(M),{modelValue:a.value,"onUpdate:modelValue":[s[0]||(s[0]=l=>a.value=l),q],label:"訂房日期",multiple:"range",min:V.value,"max-weight":"365"},null,8,["modelValue","min"])]),_:1}),e(u,{cols:"3"},{default:t(()=>[e(h,{color:"primary",type:"submit","prepend-icon":"mdi-cart",onClick:B,disabled:a.value===null||i.value<=0},{default:t(()=>[H(_(a.value===null?"請先選擇日期":i.value>0?"加入購物車":"已售完"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}},X=v("h1",{class:"text-center"},"立即訂房",-1),oe={__name:"aboutroom",setup(d){const{api:p}=S(),g=y([]);return(async()=>{try{const{data:c}=await p.get("/product",{params:{itemsPerPage:100}});g.value=c.result.data}catch(c){console.error(c)}})(),(c,m)=>(f(),x(z,null,{default:t(()=>[e(G,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[X]),_:1}),(f(!0),k(U,null,Q(g.value,a=>(f(),x(u,{cols:"12",key:a._id},{default:t(()=>[e(W,w({ref_for:!0},a),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{oe as default};
