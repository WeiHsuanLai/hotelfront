import{u as I,aE as D,i as N,r as h,L as $,a as q,o as d,a3 as v,w as t,b as e,N as L,h as b,t as g,c as y,a6 as P,d as O,l as T,V as A,n as w,e as F,F as H,$ as R}from"./index-DjxrM9kz.js";import{V as l}from"./VCol-CxPt3hGo.js";import{V as U}from"./VDateInput-BAxGck37.js";import{V as j}from"./VContainer-BlsM2P_3.js";import{V as Q}from"./VRow-mQ6G9vCQ.js";import"./calendar-CD_3N7hp.js";import"./VMenu-CszNxHnm.js";const z={key:0},G={key:1},J={__name:"ProductCard",props:["_id","category","description","quantity","image","name","price","sell"],setup(c){const p=I(),f=D(),u=N(),{apiAuth:i}=w(),_=c,o=h(null),V=$(()=>new Date().toISOString().split("T")[0]),m=h(0),C=async()=>{if(p.isLogin){if(o.value===null){u({text:"沒有選擇日期",snackbarProps:{color:"red"}});return}else if(o.value[1]===V.value){u({text:"結束日期不能為今天",snackbarProps:{color:"red"}});return}}else{f.push("/login");return}const r=await p.addCart(_._id,1,o.value);u({text:r.text,snackbarProps:{color:r.color}})},S=async r=>{if(r!==null){const n=r[0];m.value=_.quantity;const s=new Date(n);s.setHours(s.getHours()+8);const a=s.toISOString();await B(a),console.log("finaldate",a)}else u({text:"要選範圍",snackbarProps:{color:"red"}})},B=async r=>{var n,s;try{const{data:a}=await i.get("/order/all");console.log("data.result",a.result),a.result.forEach(k=>{k.cart.forEach(x=>{x.p_id._id===_._id&&x.date.forEach(E=>{r===E&&(m.value-=k.cart[0].quantity)})})})}catch(a){console.log(a),u({text:((s=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}};return(r,n)=>{const s=q("router-link");return d(),v(A,{class:"d-flex align-center text-center h-100"},{default:t(()=>[e(l,{cols:"3"},{default:t(()=>[e(L,{src:c.image,cover:"",height:"500"},null,8,["src"])]),_:1}),e(l,{col:"1"},{default:t(()=>[e(s,{to:"/products/"+c._id},{default:t(()=>[b(g(c.category),1)]),_:1},8,["to"])]),_:1}),e(l,null,{default:t(()=>[o.value?(d(),y("h3",z,"剩餘數量: "+g(m.value),1)):(d(),y("h3",G,"請選擇日期"))]),_:1}),e(l,null,{default:t(()=>[P("h3",null,"價格$"+g(c.price),1)]),_:1}),e(l,{cols:"2"},{default:t(()=>[e(O(U),{modelValue:o.value,"onUpdate:modelValue":[n[0]||(n[0]=a=>o.value=a),S],label:"訂房日期",multiple:"range",min:V.value,"max-weight":"365"},null,8,["modelValue","min"])]),_:1}),e(l,{cols:"3"},{default:t(()=>[e(T,{color:"primary",type:"submit","prepend-icon":"mdi-cart",onClick:C,disabled:o.value===null||m.value<=0},{default:t(()=>[b(g(o.value===null?"請先選擇日期":m.value>0?"加入購物車":"已售完"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})}}},K=P("h1",{class:"text-center"},"客房介紹",-1),ae={__name:"aboutroom",setup(c){const{api:p}=w(),f=h([]);return(async()=>{try{const{data:i}=await p.get("/product",{params:{itemsPerPage:100}});f.value=i.result.data}catch(i){console.error(i)}})(),(i,_)=>(d(),v(j,null,{default:t(()=>[e(Q,null,{default:t(()=>[e(l,{cols:"12"},{default:t(()=>[K]),_:1}),(d(!0),y(H,null,F(f.value,o=>(d(),v(l,{cols:"12",key:o._id},{default:t(()=>[e(J,R({ref_for:!0},o),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{ae as default};
