import{u as T,aJ as A,i as R,r as V,L as P,o as c,a3 as x,w as e,b as t,N as j,a6 as y,t as v,m as F,l as k,$ as S,V as w,j as H,c as g,F as q,e as D,ak as Q,k as U,a5 as z,d as J,h as M,n as B}from"./index-BsXL62he.js";import{V as u}from"./VCol-Cuko-4rS.js";import{V as G}from"./VDateInput-B3Ydt4rV.js";import{V as K}from"./VContainer-PLCfgy2R.js";import{V as W}from"./VRow-Z2pxMIIR.js";import"./calendar-DXWcssGF.js";import"./VMenu-C1E5Q8tI.js";const X={key:0},Y={key:1},Z={__name:"ProductCard",props:["_id","category","description","quantity","image","name","price","sell"],setup(p){const m=T(),h=A(),o=R(),{apiAuth:i}=B(),f=p,r=V(null),b=P(()=>new Date().toISOString().split("T")[0]),d=V(0),E=async a=>{if(a!==null){const n=a[0];d.value=f.quantity;const l=new Date(n);l.setHours(l.getHours()+8);const s=l.toISOString();await I(s)}else o({text:"要選範圍",snackbarProps:{color:"red"}})},I=async a=>{var n,l;try{const{data:s}=await i.get("/order/all");s.result.forEach(_=>{_.cart.forEach(C=>{C.p_id._id===f._id&&C.date.forEach(O=>{a===O&&(d.value-=_.cart[0].quantity)})})})}catch(s){console.log(s),o({text:((l=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:l.message)||"發生錯誤",snackbarProps:{color:"red"}})}},$=async()=>{if(!m.isLogin){h.push("/login");return}if(r.value===null){o({text:"沒有選擇日期",snackbarProps:{color:"red"}});return}else if(r.value.length<2){o({text:"請選擇至少兩天的日期範圍",snackbarProps:{color:"red"}});return}else if(r.value[1]===b.value){o({text:"結束日期不能為今天",snackbarProps:{color:"red"}});return}try{const{data:a}=await i.get("/user/cart");if(console.log("finalQuantity.value",d.value),a.result.length===0){const n=m.addCart(f._id,1,r.value);o({text:"增加成功",snackbarProps:{color:"green"}})}else if(d.value>=a.result[0].quantity+1){const n=m.addCart(f._id,1,r.value);o({text:"增加成功",snackbarProps:{color:"green"}}),console.log("data.result[0].quantity",a.result[0].quantity)}else o({text:"房間數量不足",snackbarProps:{color:"red"}})}catch(a){console.error("添加購物車時出錯:",a),o({text:"發生錯誤，請稍後再試",snackbarProps:{color:"red"}})}},L=P(()=>f.description.split(`
`)),N=a=>a===0||a===1?"title":a===3?"red-text":"";return(a,n)=>(c(),x(w,{class:"d-flex align-center text-center h-100"},{default:e(()=>[t(u,{cols:"3"},{default:e(()=>[t(j,{src:p.image,cover:"",height:"500"},null,8,["src"])]),_:1}),t(u,{col:"1"},{default:e(()=>[y("h3",null,v(p.name),1)]),_:1}),t(u,null,{default:e(()=>[t(F,{"max-width":"500"},{activator:e(({props:l})=>[t(k,S(l,{color:"surface-variant",text:"MORE",variant:"flat"}),null,16)]),default:e(({isActive:l})=>[t(w,null,{default:e(()=>[t(H,null,{default:e(()=>[y("div",null,[(c(!0),g(q,null,D(L.value,(s,_)=>(c(),g("div",{key:_,class:Q(N(_))},v(s),3))),128))])]),_:1}),t(U,null,{default:e(()=>[t(k,{text:"關閉介紹",onClick:s=>l.value=!1,color:"black",variant:"flat"},null,8,["onClick"]),t(z)]),_:2},1024)]),_:2},1024)]),_:1})]),_:1}),t(u,null,{default:e(()=>[r.value?(c(),g("h3",X,"剩餘數量: "+v(d.value),1)):(c(),g("h3",Y,"請選擇日期"))]),_:1}),t(u,null,{default:e(()=>[y("h3",null,"價格$"+v(p.price),1)]),_:1}),t(u,{cols:"2"},{default:e(()=>[t(J(G),{modelValue:r.value,"onUpdate:modelValue":[n[0]||(n[0]=l=>r.value=l),E],label:"訂房日期",multiple:"range",min:b.value,"max-weight":"365"},null,8,["modelValue","min"])]),_:1}),t(u,{cols:"3"},{default:e(()=>[t(k,{color:"primary",type:"submit","prepend-icon":"mdi-cart",onClick:$,disabled:r.value===null||d.value<=0},{default:e(()=>[M(v(r.value===null?"請先選擇日期":d.value>0?"加入購物車":"已售完"),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}},tt=y("h1",{class:"text-center"},"立即訂房",-1),ut={__name:"aboutroom",setup(p){const{api:m}=B(),h=V([]);return(async()=>{try{const{data:i}=await m.get("/product",{params:{itemsPerPage:100}});h.value=i.result.data}catch(i){console.error(i)}})(),(i,f)=>(c(),x(K,null,{default:e(()=>[t(W,null,{default:e(()=>[t(u,{cols:"12"},{default:e(()=>[tt]),_:1}),(c(!0),g(q,null,D(h.value,r=>(c(),x(u,{cols:"12",key:r._id},{default:e(()=>[t(Z,S({ref_for:!0},r),null,16)]),_:2},1024))),128))]),_:1})]),_:1}))}};export{ut as default};
