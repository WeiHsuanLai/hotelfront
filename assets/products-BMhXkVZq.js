import{p as re,aO as Pe,aP as Ce,v as se,X as he,aQ as ke,aR as Fe,L as E,x as ue,aS as we,aT as ae,b as l,$ as G,D as L,ao as De,M as Te,F as j,aU as Be,aV as Ie,r as g,K as Re,a0 as Ue,T as Me,S as W,U as Ae,aW as qe,aX as Ne,ap as de,aq as $e,aY as He,aZ as Ee,a_ as Ge,aj as te,a$ as ze,P as Le,R as Oe,i as je,c as _e,w as v,m as Ke,n as We,a as Xe,o as le,l as Z,h as J,b0 as ee,b1 as Qe,N as Ye,a3 as ce,a4 as ve,f as Ze,d,V as Je,g as ea,t as aa,j as ta,k as la,a6 as oa,aN as me}from"./index-D-hUD55q.js";import{c as na,a as oe,b as fe,d as ra}from"./index.esm-CM_mT7FP.js";import{u as sa,a as O}from"./vee-validate.esm-DSOhr7Zn.js";import{b as ge}from"./route-block-B_A1xBdJ.js";import{V as ua}from"./VContainer-Crlvk4pJ.js";import{V as ia}from"./VRow-Bxcl6h7F.js";import{V as ne}from"./VCol-BtQA7j8E.js";import{m as da,a as pe,b as ca,c as va,d as ma,e as fa,f as ga,g as pa,h as ba,u as Va,p as ya,i as xa,j as Pa,k as ha,l as ka,n as wa,o as Sa,q as be,r as Ve,s as ye,t as xe,v as Ca}from"./VDataTable-j9Fds0Q8.js";import{V as Fa}from"./VDivider-DBRFc7CE.js";import{V as Da}from"./VForm-CWXCPe9_.js";import"./VList-8wkA2EcP.js";import"./ssrBoot-OTi3D2rZ.js";import"./VMenu-Bd2fGmC_.js";import"./VChip-BCGm2WeE.js";const Ta=re({...Pe(),...Ce(da(),["inline"])},"VCheckbox"),Ba=se()({name:"VCheckbox",inheritAttrs:!1,props:Ta(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,I){let{attrs:S,slots:o}=I;const r=he(e,"modelValue"),{isFocused:c,focus:h,blur:A}=ke(e),D=Fe(),R=E(()=>e.id||`checkbox-${D}`);return ue(()=>{const[U,q]=we(S),C=ae.filterProps(e),f=pe.filterProps(e);return l(ae,G({class:["v-checkbox",e.class]},U,C,{modelValue:r.value,"onUpdate:modelValue":b=>r.value=b,id:R.value,focused:c.value,style:e.style}),{...o,default:b=>{let{id:x,messagesId:T,isDisabled:k,isReadonly:w,isValid:N}=b;return l(pe,G(f,{id:x.value,"aria-describedby":T.value,disabled:k.value,readonly:w.value},q,{error:N.value===!1,modelValue:r.value,"onUpdate:modelValue":z=>r.value=z,onFocus:h,onBlur:A}),o)}})}),{}}}),Ia=re({itemsLength:{type:[Number,String],required:!0},...ca(),...va(),...ma()},"VDataTableServer"),Ra=se()({name:"VDataTableServer",props:Ia(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,I){let{attrs:S,slots:o}=I;const{groupBy:r}=fa(e),{sortBy:c,multiSort:h,mustSort:A}=ga(e),{page:D,itemsPerPage:R}=pa(e),U=E(()=>parseInt(e.itemsLength,10)),{columns:q,headers:C}=ba(e,{groupBy:r,showSelect:L(e,"showSelect"),showExpand:L(e,"showExpand")}),{items:f}=Va(e,q),{toggleSort:b}=ya({sortBy:c,multiSort:h,mustSort:A,page:D}),{opened:x,isGroupOpen:T,toggleGroup:k,extractRows:w}=xa({groupBy:r,sortBy:c}),{pageCount:N,setItemsPerPage:z}=Pa({page:D,itemsPerPage:R,itemsLength:U}),{flatItems:$}=ha(f,r,x),{isSelected:P,select:F,selectAll:M,toggleSelect:B,someSelected:V,allSelected:u}=ka(e,{allItems:f,currentPage:f}),{isExpanded:m,toggleExpand:i}=wa(e),n=E(()=>w(f.value));Sa({page:D,itemsPerPage:R,sortBy:c,groupBy:r,search:L(e,"search")}),De("v-data-table",{toggleSort:b,sortBy:c}),Te({VDataTableRows:{hideNoData:L(e,"hideNoData"),noDataText:L(e,"noDataText"),loading:L(e,"loading"),loadingText:L(e,"loadingText")}});const a=E(()=>({page:D.value,itemsPerPage:R.value,sortBy:c.value,pageCount:N.value,toggleSort:b,setItemsPerPage:z,someSelected:V.value,allSelected:u.value,isSelected:P,select:F,selectAll:M,toggleSelect:B,isExpanded:m,toggleExpand:i,isGroupOpen:T,toggleGroup:k,items:n.value.map(p=>p.raw),internalItems:n.value,groupedItems:$.value,columns:q.value,headers:C.value}));ue(()=>{const p=be.filterProps(e),t=Ve.filterProps(e),s=ye.filterProps(e),y=xe.filterProps(e);return l(xe,G({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},y),{top:()=>{var H;return(H=o.top)==null?void 0:H.call(o,a.value)},default:()=>{var H,_,X,Q,Y,K;return o.default?o.default(a.value):l(j,null,[(H=o.colgroup)==null?void 0:H.call(o,a.value),!e.hideDefaultHeader&&l("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[l(Ve,G(t,{sticky:e.fixedHeader}),o)]),(_=o.thead)==null?void 0:_.call(o,a.value),!e.hideDefaultBody&&l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(X=o["body.prepend"])==null?void 0:X.call(o,a.value),o.body?o.body(a.value):l(ye,G(S,s,{items:$.value}),o),(Q=o["body.append"])==null?void 0:Q.call(o,a.value)]),(Y=o.tbody)==null?void 0:Y.call(o,a.value),(K=o.tfoot)==null?void 0:K.call(o,a.value)])},bottom:()=>o.bottom?o.bottom(a.value):!e.hideDefaultFooter&&l(j,null,[l(Fa,null,null),l(be,p,{prepend:o["footer.prepend"]})])})})}}),Ua=re({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Pe(),...Be()},"VTextarea"),Ma=se()({name:"VTextarea",directives:{Intersect:Ie},inheritAttrs:!1,props:Ua(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,I){let{attrs:S,emit:o,slots:r}=I;const c=he(e,"modelValue"),{isFocused:h,focus:A,blur:D}=ke(e),R=E(()=>typeof e.counterValue=="function"?e.counterValue(c.value):(c.value||"").toString().length),U=E(()=>{if(S.maxlength)return S.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function q(u,m){var i,n;!e.autofocus||!u||(n=(i=m[0].target)==null?void 0:i.focus)==null||n.call(i)}const C=g(),f=g(),b=Re(""),x=g(),T=E(()=>e.persistentPlaceholder||h.value||e.active);function k(){var u;x.value!==document.activeElement&&((u=x.value)==null||u.focus()),h.value||A()}function w(u){k(),o("click:control",u)}function N(u){o("mousedown:control",u)}function z(u){u.stopPropagation(),k(),te(()=>{c.value="",ze(e["onClick:clear"],u)})}function $(u){var i;const m=u.target;if(c.value=m.value,(i=e.modelModifiers)!=null&&i.trim){const n=[m.selectionStart,m.selectionEnd];te(()=>{m.selectionStart=n[0],m.selectionEnd=n[1]})}}const P=g(),F=g(+e.rows),M=E(()=>["plain","underlined"].includes(e.variant));Ue(()=>{e.autoGrow||(F.value=+e.rows)});function B(){e.autoGrow&&te(()=>{if(!P.value||!f.value)return;const u=getComputedStyle(P.value),m=getComputedStyle(f.value.$el),i=parseFloat(u.getPropertyValue("--v-field-padding-top"))+parseFloat(u.getPropertyValue("--v-input-padding-top"))+parseFloat(u.getPropertyValue("--v-field-padding-bottom")),n=P.value.scrollHeight,a=parseFloat(u.lineHeight),p=Math.max(parseFloat(e.rows)*a+i,parseFloat(m.getPropertyValue("--v-input-control-height"))),t=parseFloat(e.maxRows)*a+i||1/0,s=Oe(n??0,p,t);F.value=Math.floor((s-i)/a),b.value=Le(s)})}Me(B),W(c,B),W(()=>e.rows,B),W(()=>e.maxRows,B),W(()=>e.density,B);let V;return W(P,u=>{u?(V=new ResizeObserver(B),V.observe(P.value)):V==null||V.disconnect()}),Ae(()=>{V==null||V.disconnect()}),ue(()=>{const u=!!(r.counter||e.counter||e.counterValue),m=!!(u||r.details),[i,n]=we(S),{modelValue:a,...p}=ae.filterProps(e),t=qe(e);return l(ae,G({ref:C,modelValue:c.value,"onUpdate:modelValue":s=>c.value=s,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":M.value},e.class],style:e.style},i,p,{centerAffix:F.value===1&&!M.value,focused:h.value}),{...r,default:s=>{let{id:y,isDisabled:H,isDirty:_,isReadonly:X,isValid:Q}=s;return l(Ne,G({ref:f,style:{"--v-textarea-control-height":b.value},onClick:w,onMousedown:N,"onClick:clear":z,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},t,{id:y.value,active:T.value||_.value,centerAffix:F.value===1&&!M.value,dirty:_.value||e.dirty,disabled:H.value,focused:h.value,error:Q.value===!1}),{...r,default:Y=>{let{props:{class:K,...ie}}=Y;return l(j,null,[e.prefix&&l("span",{class:"v-text-field__prefix"},[e.prefix]),de(l("textarea",G({ref:x,class:K,value:c.value,onInput:$,autofocus:e.autofocus,readonly:X.value,disabled:H.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:k,onBlur:D},ie,n),null),[[$e("intersect"),{handler:q},null,{once:!0}]]),e.autoGrow&&de(l("textarea",{class:[K,"v-textarea__sizer"],id:`${ie.id}-sizer`,"onUpdate:modelValue":Se=>c.value=Se,ref:P,readonly:!0,"aria-hidden":"true"},null),[[He,c.value]]),e.suffix&&l("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:m?s=>{var y;return l(j,null,[(y=r.details)==null?void 0:y.call(r,s),u&&l(j,null,[l("span",null,null),l(Ee,{active:e.persistentCounter||h.value,value:R.value,max:U.value,disabled:e.disabled},r.counter)])])}:void 0})}),Ge({},C,f,x)}}),Aa=oa("h1",{class:"text-center"},"商品管理",-1),qa={__name:"products",setup(e){const{apiAuth:I}=We(),S=je(),o=g(null),r=g({open:!1,id:""}),c=n=>{n?(r.value.id=n._id,C.value.value=n.name,f.value.value=n.price,b.value.value=n.description,k.value.value=n.quantity,x.value.value=n.category,T.value.value=n.sell):r.value.id="",r.value.open=!0},h=()=>{r.value.open=!1,q(),o.value.deleteFileRecord()},A=["單人房","雙人房","四人房"],D=na({name:oe().required("商品名稱必填"),price:fe().typeError("商品價格格式錯誤").required("商品價格必填").min(0,"商品價格不能小於 0"),description:oe().required("商品說明必填"),category:oe().required("商品分類必填").test("isCategory","商品分類錯誤",n=>A.includes(n)),quantity:fe().typeError("商品數量格式錯誤").required("商品數量必填").min(0,"商品數量不能小於 0"),sell:ra()}),{handleSubmit:R,isSubmitting:U,resetForm:q}=sa({validationSchema:D,initialValues:{name:"",price:0,description:"",category:"",quantity:0,sell:!0}}),C=O("name"),f=O("price"),b=O("description"),x=O("category"),T=O("sell"),k=O("quantity"),w=g([]),N=g([]),z=R(async n=>{var a,p,t;if(!((a=w.value[0])!=null&&a.error)&&!(r.value.id.length===0&&w.value.length<1))try{const s=new FormData;s.append("name",n.name),s.append("price",n.price),s.append("description",n.description),s.append("category",n.category),s.append("sell",n.sell),s.append("quantity",n.quantity),s.append("date",n.date),w.value.length>0&&s.append("image",w.value[0].file),r.value.id===""?await I.post("/product",s):await I.patch("/product/"+r.value.id,s),S({text:r.value.id===""?"新增成功":"編輯成功",snackbarProps:{color:"green"}}),h(),i(!0)}catch(s){console.log(s),S({text:((t=(p=s==null?void 0:s.response)==null?void 0:p.data)==null?void 0:t.message)||"發生錯誤",snackbarProps:{color:"red"}})}}),$=g(10),P=g([{key:"createdAt",order:"desc"}]),F=g(1),M=g([]),B=[{title:"圖片",align:"center",sortable:!1,key:"image"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"房間數量",align:"center",sortable:!0,key:"quantity"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"操作",align:"center",sortable:!1,key:"action"}],V=g(!0),u=g(0),m=g(""),i=async n=>{var a,p,t,s;n&&(F.value=1),V.value=!0;try{const{data:y}=await I.get("/product/all",{params:{page:F.value,itemsPerPage:$.value,sortBy:((a=P.value[0])==null?void 0:a.key)||"createdAt",sortOrder:((p=P.value[0])==null?void 0:p.order)||"desc",search:m.value}});M.value.splice(0,M.value.length,...y.result.data),u.value=y.result.total}catch(y){console.log(y),S({text:((s=(t=y==null?void 0:y.response)==null?void 0:t.data)==null?void 0:s.message)||"發生錯誤",snackbarProps:{color:"red"}})}V.value=!1};return i(),(n,a)=>{const p=Xe("vue-file-agent");return le(),_e(j,null,[l(ua,null,{default:v(()=>[l(ia,null,{default:v(()=>[l(ne,{cols:"12"},{default:v(()=>[Aa]),_:1}),l(ne,{cols:"12"},{default:v(()=>[l(Z,{color:"green",onClick:a[0]||(a[0]=t=>c(null))},{default:v(()=>[J("新增商品")]),_:1})]),_:1}),l(ne,{cols:"12"},{default:v(()=>[l(Ra,{"items-per-page":$.value,"onUpdate:itemsPerPage":[a[4]||(a[4]=t=>$.value=t),a[7]||(a[7]=t=>i(!1))],"sort-by":P.value,"onUpdate:sortBy":[a[5]||(a[5]=t=>P.value=t),a[8]||(a[8]=t=>i(!1))],page:F.value,"onUpdate:page":[a[6]||(a[6]=t=>F.value=t),a[9]||(a[9]=t=>i(!1))],items:M.value,headers:B,loading:V.value,"items-length":u.value,search:m.value,hover:""},{top:v(()=>[l(ee,{label:"搜尋",modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=t=>m.value=t),"append-icon":"mdi-magnify",onClickAppend:a[2]||(a[2]=t=>i(!0)),onKeydown:a[3]||(a[3]=Qe(t=>i(!0),["enter"]))},null,8,["modelValue"])]),"item.image":v(({value:t})=>[l(Ye,{src:t,height:"50px"},null,8,["src"])]),"item.sell":v(({value:t})=>[t?(le(),ce(me,{key:0,icon:"mdi-check"})):ve("",!0)]),"item.date":v(({value:t})=>[t?(le(),ce(me,{key:0,icon:"mdi-check"})):ve("",!0)]),"item.action":v(({item:t})=>[l(Z,{icon:"mdi-pencil",variant:"text",color:"blue",onClick:s=>c(t)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1})]),_:1}),l(Ke,{modelValue:r.value.open,"onUpdate:modelValue":a[18]||(a[18]=t=>r.value.open=t),persistent:"",width:"500"},{default:v(()=>[l(Da,{onSubmit:Ze(d(z),["prevent"]),disabled:d(U)},{default:v(()=>[l(Je,null,{default:v(()=>[l(ea,null,{default:v(()=>[J(aa(r.value.id?"編輯商品":"新增商品"),1)]),_:1}),l(ta,null,{default:v(()=>[l(ee,{label:"名稱",modelValue:d(C).value.value,"onUpdate:modelValue":a[10]||(a[10]=t=>d(C).value.value=t),"error-messages":d(C).errorMessage.value},null,8,["modelValue","error-messages"]),l(ee,{label:"價格",type:"number",min:"0",modelValue:d(f).value.value,"onUpdate:modelValue":a[11]||(a[11]=t=>d(f).value.value=t),"error-messages":d(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ca,{label:"分類",items:A,modelValue:d(x).value.value,"onUpdate:modelValue":a[12]||(a[12]=t=>d(x).value.value=t),"error-messages":d(x).errorMessage.value},null,8,["modelValue","error-messages"]),l(ee,{label:"房間數量",type:"number",min:"1",modelValue:d(k).value.value,"onUpdate:modelValue":a[13]||(a[13]=t=>d(k).value.value=t),"error-messages":d(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ba,{label:"上架",modelValue:d(T).value.value,"onUpdate:modelValue":a[14]||(a[14]=t=>d(T).value.value=t),"error-messages":d(T).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ma,{label:"說明",modelValue:d(b).value.value,"onUpdate:modelValue":a[15]||(a[15]=t=>d(b).value.value=t),"error-messages":d(b).errorMessage.value},null,8,["modelValue","error-messages"]),l(p,{modelValue:w.value,"onUpdate:modelValue":a[16]||(a[16]=t=>w.value=t),"raw-model-value":N.value,"onUpdate:rawModelValue":a[17]||(a[17]=t=>N.value=t),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:o},null,8,["modelValue","raw-model-value"])]),_:1}),l(la,null,{default:v(()=>[l(Z,{color:"red",loading:d(U),onClick:h},{default:v(()=>[J("取消")]),_:1},8,["loading"]),l(Z,{color:"green",type:"submit",loading:d(U)},{default:v(()=>[J("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])],64)}}};typeof ge=="function"&&ge(qa);export{qa as default};
