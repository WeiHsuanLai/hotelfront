import{i as E,u as N,r as V,L as w,a3 as P,w as s,aE as A,o as h,b as n,c as S,t as d,l as u,h as y,a6 as f,n as L}from"./index-YyHzES5v.js";import{V as R}from"./VContainer-CnZVlQ52.js";import{V as m}from"./VCol-D6WDSyfM.js";import{V as U}from"./VDivider-23ly3y9Q.js";import{V as j}from"./VDataTable-Cz3Bs2nS.js";import"./VList-2h9QHaLA.js";import"./ssrBoot-CnsGCEGU.js";import"./VMenu-DmnpUom-.js";import"./VChip-CibmAyN4.js";const z=f("h1",{class:"text-center"},"購物車",-1),F={key:0},G={key:1,class:"text-red"},et={__name:"cart",props:["_id","category","description","quantity","image","name","price","sell","room"],setup(H){const{apiAuth:k}=L(),b=A(),p=E(),v=N(),l=V([]),B=[{title:"品名",key:"p_id.name"},{title:"房間價格",key:"p_id.price"},{title:"房間數量",key:"quantity"},{title:"日期",key:"date",value:e=>{const a=e.date;if(a&&a.length>0){const t=new Date(a[0]).toISOString().split("T")[0];let o="";if(a.length===1)o=new Date(new Date(t).setDate(new Date(t).getDate()+1)).toISOString().split("T")[0];else if(a.length>1){console.log("dates.length",a.length);const r=new Date(a[a.length-1]);r.setDate(r.getDate()+1),o=r.toISOString().split("T")[0]}return`${t}日入住 至 ${o} 日退房`}return"無日期"}},{title:"天數",key:"days",value:e=>e.date?e.date.length:0},{title:"總價",key:"total",value:e=>e.p_id.price*e.quantity*(e.date?e.date.length:0)},{title:"操作",key:"action"}],D=async()=>{var e,a;try{const{data:t}=await k.get("/user/cart");l.value=t.result;const o=l.value.map(r=>r.quantity)}catch(t){console.log(t),p({text:((a=(e=t==null?void 0:t.response)==null?void 0:e.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}};D();const I=w(()=>l.value.reduce((e,a)=>e+a.quantity*a.p_id.price*a.date.length,0)),O=w(()=>l.value.length>0&&!l.value.some(e=>!e.p_id.sell)),x=V(!1),T=async()=>{x.value=!0;const e=await v.checkout();p({text:e.text,snackbarProps:{color:e.color}}),e.color==="green"&&b.push("/orders"),x.value=!1},_=async(e,a,t)=>{const{data:o}=await k.get("/order/all");o.result[o.result.length-1].cart[0],console.log("aaaaaa",o.result[o.result.length-1].cart[0].p_id.quantity);let q=o.result[o.result.length-1].cart[0].p_id.quantity;o.result.forEach(c=>{c.cart.forEach(i=>{const C=o.result[o.result.length-1].cart[0].p_id._id;if(console.log("idid--------",C),console.log("date---------",i),console.log("date.quantity---------",i.quantity),i.p_id._id===C){const $=i.quantity;q-=$,console.log(q)}})});const g=await v.addCart(e,a,t);if(p({text:g.text,snackbarProps:{color:g.color}}),D(),g.color==="green"){const c=l.value.findIndex(i=>i.p_id._id===e);console.log("Date parameter:",t),l.value[c].quantity+=a,l.value[c].quantity<=0&&l.value.splice(c,1)}};return(e,a)=>(h(),P(R,null,{default:s(()=>[n(m,{cols:"12"},{default:s(()=>[z]),_:1}),n(U),n(m,{cols:"12"},{default:s(()=>[n(j,{items:l.value,headers:B},{"item.p_id.name":s(({item:t})=>[t.p_id.sell?(h(),S("span",F,d(t.p_id.name),1)):(h(),S("span",G,d(t.p_id.name)+" (已下架)",1))]),"item.quantity":s(({item:t})=>[n(u,{variant:"text",color:"red",onClick:o=>_(t.p_id._id,-1,t.date)},{default:s(()=>[y("-")]),_:2},1032,["onClick"]),f("span",null,d(t.quantity),1),n(u,{variant:"text",color:"green",onClick:o=>_(t.p_id._id,1,t.date)},{default:s(()=>[y("+")]),_:2},1032,["onClick"])]),"item.action":s(({item:t})=>[n(u,{variant:"text",color:"red",icon:"mdi-delete",onClick:o=>_(t.p_id._id,t.quantity*-1,t.date*1)},null,8,["onClick"])]),_:2},1032,["items"])]),_:1}),n(m,{cols:"12",class:"text-center"},{default:s(()=>[f("p",null,"總金額: "+d(I.value),1),n(u,{color:"green",disabled:!O.value,onClick:T},{default:s(()=>[y("結帳")]),_:1},8,["disabled"])]),_:1})]),_:1}))}};export{et as default};
